function rand(){return globalRandom.v()}function randF(t,e){return globalRandom.f(t,e)}function randI(t,e){return globalRandom.i(t,e)}function randBool(){return globalRandom.bool()}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},GameObject=function(){function t(){this.display=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.baseDisplay=e,t.gameDisplay=new egret.DisplayObjectContainer,t.baseDisplay.addChild(t.gameDisplay)},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t._delete(),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t._delete(),!1})},t.prototype._delete=function(){this.onDestroy(),this.display&&(this.display.parent.removeChild(this.display),this.display=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Camera2D=function(){function t(){}return t.initial=function(){t.x=0,t.y=0,t.localX=0,t.localY=0,t.scale=1,t.rotation=0},t.process=function(){GameObject.gameDisplay.anchorOffsetX=t.x,GameObject.gameDisplay.anchorOffsetY=t.y,GameObject.gameDisplay.x=this.localX,GameObject.gameDisplay.y=this.localY,GameObject.gameDisplay.scaleX=GameObject.gameDisplay.scaleY=t.scale,GameObject.gameDisplay.rotation=t.rotation},t}();__reflect(Camera2D.prototype,"Camera2D");var EffectSmoke=function(t){function e(e,i,s,a,r){var n=t.call(this)||this;return n.setShape(e,i,r),n.vx=s,n.vy=a,n}return __extends(e,t),e.prototype.setShape=function(t,e,i){var s=this.display;null==this.display?(this.display=s=new egret.Shape,GameObject.gameDisplay.addChild(this.display)):s.graphics.clear(),s.x=t,s.y=e,s.graphics.beginFill(15790320),s.graphics.drawCircle(0,0,i),s.graphics.endFill(),s.alpha=.5+randF(-.1,.1)},e.prototype.update=function(){this.display.x+=this.vx,this.display.y+=this.vy,this.vx*=.9,this.vy*=.9,this.display.scaleX-=1/32,this.display.scaleY=this.display.scaleX,this.display.alpha-=.5/30,this.display.alpha<.01&&this.destroy()},e}(GameObject);__reflect(EffectSmoke.prototype,"EffectSmoke");var PLAYER_WIDTH_PER_H=.0425,PLAYER_HEIGHT_PER_H=.053125,PLAYER_MIN_SPEED_PER_H=1/110*.85,PLAYER_MAX_SPEED_PER_H=1/75*.85,START_X_PER_H=0,START_Y_PER_H=0,ROAD_RADIUS_PER_H=1/3*.85,COIN_RADIUS_PER_H=1/48*.85,SAVE_KEY_BESTSCORE="drift-bestScore",BACK_COLOR=1081488,ROAD_COLOR=4214880,FONT_COLOR=16777215,FONT_COLOR2=16777215,PLAYER_COLOR=12607712,COIN_COLOR=16773120,Game=function(){function t(){}return t.loadSceneGamePlay=function(){new Player(Util.h(START_X_PER_H),Util.h(START_Y_PER_H)),new Wave,new StartMessage,new Score},t}();__reflect(Game.prototype,"Game");var Player=function(t){function e(i,s){var a=t.call(this)||this;return a.rd=0,a.rv=0,a.state=a.stateNone,e.I=a,a.sizeW=Util.h(PLAYER_WIDTH_PER_H),a.sizeH=Util.h(PLAYER_HEIGHT_PER_H),a.radius=a.sizeW/2,a.color=PLAYER_COLOR,a.speed=Util.h(PLAYER_MIN_SPEED_PER_H),a.vx=0,a.vy=0,a.setDisplay(i,s),a.display.rotation=-45,Camera2D.x=0,a.scrollCamera(1),a.button=new Button(null,0,0,.5,.5,1,1,0,0,null),a}return __extends(e,t),Object.defineProperty(e.prototype,"x",{get:function(){return this.display.x},set:function(t){this.display.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.display.y},set:function(t){this.display.y=t},enumerable:!0,configurable:!0}),e.prototype.onDestroy=function(){this.button.destroy(),e.I=null},e.prototype.setDisplay=function(t,e){var i=this.display;null==this.display?(this.display=i=new egret.Shape,GameObject.gameDisplay.addChildAt(this.display,1)):i.graphics.clear(),i.x=t,i.y=e,i.graphics.beginFill(this.color),i.graphics.drawRect(-.5*this.sizeW,-.5*this.sizeH,this.sizeW,this.sizeH),i.graphics.endFill()},e.prototype.update=function(){this.state()},e.prototype.setStateNone=function(){this.state=this.stateNone},e.prototype.stateNone=function(){},e.prototype.setStateRun=function(){this.state=this.stateRun},e.prototype.stateRun=function(){this.rd=this.button.touch?45:-45,this.rv*=.5,this.rv+=Util.clamp(this.rd-this.display.rotation,-2,2),this.display.rotation+=this.rv,this.speed=Util.lerp(Util.h(PLAYER_MIN_SPEED_PER_H),Util.h(PLAYER_MAX_SPEED_PER_H),Wave.hardRate);var t=Math.sin(this.display.rotation*(Math.PI/180)),e=-Math.cos(this.display.rotation*(Math.PI/180)),i=.98;this.vx*=i,this.vy*=i,this.vx+=t*this.speed*(1-i),this.vy+=e*this.speed*(1-i),this.x+=this.vx,this.y+=this.vy,this.scrollCamera(),Math.pow(this.rv,2)>=Math.pow(.1,2)&&0==randI(0,3)&&new EffectSmoke(this.x,this.y+randF(0,this.sizeH),t*randF(-9,1),e*randF(-9,1),this.sizeW*randF(.4,.9)),Road.checkOnRoad(this.x,this.y)||this.setStateMiss()},e.prototype.scrollCamera=function(t){void 0===t&&(t=1/16),Camera2D.x=this.x,Camera2D.y=this.y,Camera2D.localX=Util.w(.5),Camera2D.localY=Util.h(.75)},e.prototype.setStateMiss=function(){this.state!=this.stateMiss&&(new GameOver,this.state=this.stateMiss)},e.prototype.stateMiss=function(){},e.I=null,e}(GameObject);__reflect(Player.prototype,"Player");var Road=function(t){function e(i,s,a,r,n,o){var h=t.call(this)||this;h.shapes=[],e.roads.push(h),h.px0=i,h.py0=s,h.px1=a,h.py1=r,h.radius=n,h.rotation=o,h.uvx=a-i,h.uvy=r-s,h.length=Math.sqrt(Math.pow(h.uvx,2)+Math.pow(h.uvy,2));var l=1/h.length;return h.uvx*=l,h.uvy*=l,h.setDisplay(),h}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.roads=e.roads.filter(function(e){return e!=t}),this.shapes.forEach(function(t){t.parent.removeChild(t)})},e.prototype.setDisplay=function(){this.shapes[0]=new egret.Shape,this.shapes[1]=new egret.Shape,GameObject.gameDisplay.addChildAt(this.shapes[0],0),GameObject.gameDisplay.addChildAt(this.shapes[1],0);var t=this.length,e=2*this.radius;this.shapes[0].graphics.beginFill(ROAD_COLOR),this.shapes[0].graphics.drawCircle(-.5*this.length,0,this.radius),this.shapes[0].graphics.drawRect(-t/2,-e/2,t/2,e),this.shapes[0].graphics.endFill(),this.shapes[0].x=(this.px0+this.px1)/2,this.shapes[0].y=(this.py0+this.py1)/2,this.shapes[0].rotation=90+this.rotation,this.shapes[1].graphics.beginFill(ROAD_COLOR),this.shapes[1].graphics.drawRect(0,-e/2,t/2,e),this.shapes[1].graphics.drawCircle(.5*this.length,0,this.radius),this.shapes[1].graphics.endFill(),this.shapes[1].x=(this.px0+this.px1)/2,this.shapes[1].y=(this.py0+this.py1)/2,this.shapes[1].rotation=90+this.rotation},e.prototype.update=function(){this.py1-this.radius>Camera2D.y+Util.h(.5)&&(this.destroy(),Score.I.addPoint(1))},e.checkOnRoad=function(t,i){for(var s=0;s<e.roads.length;s++){var a=e.roads[s];if(a.py0+a.radius>i&&a.py1-a.radius<i){var r=t-a.px0,n=i-a.py0,o=r*a.uvx+n*a.uvy;o=Util.clamp(o,0,a.length);var h=a.px0+a.uvx*o,l=a.py0+a.uvy*o;r=t-h,n=i-l;var p=Math.pow(r,2)+Math.pow(n,2);if(p<=Math.pow(a.radius,2))return!0}}return!1},e.roads=[],e}(GameObject);__reflect(Road.prototype,"Road");var Wave=function(t){function e(){var i=t.call(this)||this;i.turnLeft=!1,e.hardRate=0,i.lastPx=Util.h(START_X_PER_H),i.lastPy=Util.h(START_Y_PER_H);var s=Util.h(1),a=i.turnLeft?45:-45,r=Util.h(ROAD_RADIUS_PER_H);return i.newRoad(s,a,r),i}return __extends(e,t),e.prototype.update=function(){for(;this.lastPy>Player.I.y-Util.h(1.2);){var t=Util.h(randF(Util.lerp(.85,.42,e.hardRate),2)),i=40;e.hardRate>=1&&0==randI(0,3)&&(i=20),i*=this.turnLeft?1:-1;var s=Util.h(ROAD_RADIUS_PER_H)*randF(Util.lerp(1,.58,e.hardRate),1);this.newRoad(t,i,s,randBool()),e.hardRate=Util.clamp(-(this.lastPy-Util.h(START_Y_PER_H))/Util.h(40),0,1)}},e.prototype.newRoad=function(t,i,s,a){void 0===a&&(a=!1);var r=i*(Math.PI/180),n=Math.sin(r),o=-Math.cos(r),h=this.lastPx+n*t,l=this.lastPy+o*t;if(new Road(this.lastPx,this.lastPy,h,l,s,i),a){var p=Util.h(1/6),c=Math.floor(.5*t/p),d=this.lastPx+n*t*.25,u=this.lastPy+o*t*.25,y=s*randF(-.8,.8)*e.hardRate;d+=Math.sin(r+Math.PI/2)*y,u+=-Math.cos(r+Math.PI/2)*y;for(var _=0;c>_;_++)new Coin(d,u),d+=n*p,u+=o*p}this.lastPx=h,this.lastPy=l,this.turnLeft=!this.turnLeft},e}(GameObject);__reflect(Wave.prototype,"Wave");var Button=function(t){function e(e,i,s,a,r,n,o,h,l,p){var c=t.call(this)||this;c.text=null,c.onTap=null,c.press=!1,c.touch=!1,c.x=0,c.y=0;var d=new egret.Shape;GameObject.baseDisplay.addChild(d),d.graphics.beginFill(h,l);var u=n*Util.width,y=o*Util.height;return d.graphics.drawRoundRect(-.5*u,-.5*y,u,y,.2*u),d.graphics.endFill(),d.touchEnabled=!0,d.x=a*Util.width,d.y=r*Util.height,c.display=d,e&&(c.text=Util.newTextField(e,i,s,a,r,!0,!1),GameObject.baseDisplay.addChild(c.text)),c.onTap=p,c.onTap&&c.display.addEventListener(egret.TouchEvent.TOUCH_TAP,c.onTap,c),c.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,c.touchBegin,c),c.display.addEventListener(egret.TouchEvent.TOUCH_MOVE,c.touchMove,c),c.display.addEventListener(egret.TouchEvent.TOUCH_END,c.touchEnd,c),c}return __extends(e,t),e.prototype.onDestroy=function(){this.onTap&&this.display.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.text&&GameObject.baseDisplay.removeChild(this.text)},e.prototype.update=function(){var t=this.touch?1.1:1;this.display.scaleX=this.display.scaleY=this.display.scaleX+.25*(t-this.display.scaleX),this.press=!1},e.prototype.touchBegin=function(t){this.x=t.stageX,this.y=t.stageY,this.press=!0,this.touch=!0},e.prototype.touchMove=function(t){this.x=t.stageX,this.y=t.stageY,this.touch=!0},e.prototype.touchEnd=function(t){this.touch=!1},e}(GameObject);__reflect(Button.prototype,"Button");var Coin=function(t){function e(e,i){var s=t.call(this)||this;return s.radius=Util.w(COIN_RADIUS_PER_H),s.setShape(e,i),s}return __extends(e,t),e.prototype.setShape=function(t,e){var i=this.display;null==this.display?(this.display=i=new egret.Shape,GameObject.gameDisplay.addChild(this.display)):i.graphics.clear(),i.x=t,i.y=e,i.graphics.beginFill(COIN_COLOR),i.graphics.drawCircle(0,0,this.radius),i.graphics.endFill()},e.prototype.update=function(){this.isPicked(),this.isOutOfScreen()},e.prototype.isPicked=function(){var t=Player.I.x-this.display.x,e=Player.I.y-this.display.y,i=Math.pow(t,2)+Math.pow(e,2);if(i<=Math.pow(Player.I.radius+this.radius,2))return Score.I.addPoint(1),this.destroy(),!0;if(Player.I.magnet>0){i=Math.sqrt(i);var s=1-Util.clamp(i/Util.w(.25),0,1);i=1/i*s*Util.width*.05,this.display.x+=t*i,this.display.y+=e*i}return!1},e.prototype.isOutOfScreen=function(){return this.display.y-this.radius>Camera2D.y+Util.h(.5)?(this.destroy(),!0):!1},e}(GameObject);__reflect(Coin.prototype,"Coin");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){Util.init(this),GameObject.initial(this.stage),Camera2D.initial(),Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),Camera2D.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Random=function(){function t(e){void 0===e&&(e=Math.floor(Math.random()*t.max)),this.x=123456789,this.y=362436069,this.z=521288629,this.w=e}return t.prototype.v=function(){return(this.next()&t.max)/(t.max+1)},t.prototype.f=function(t,e){return t+this.v()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(){return 0!=(1&this.next())},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.max=1073741823,t}();__reflect(Random.prototype,"Random");var globalRandom=new Random,Rect=function(t){function e(e,i,s,a,r,n,o){void 0===n&&(n=!1),void 0===o&&(o=!1);var h=t.call(this)||this,l=new egret.Shape;h.display=l;var p=n?GameObject.gameDisplay:GameObject.baseDisplay;return o?p.addChild(h.display):p.addChildAt(h.display,1),l.graphics.beginFill(r,1),l.graphics.drawRect(e,i,s,a),l.graphics.endFill(),h}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Rect.prototype,"Rect");var Util=function(){function t(){}return t.w=function(e){return e*t.width},t.h=function(e){return e*t.height},t.init=function(t){this.width=t.stage.stageWidth,this.height=t.stage.stageHeight},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.lerp=function(t,e,i){return t+(e-t)*i},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var s=1-i,a=((16711680&t)*s+(16711680&e)*i&16711680)+((65280&t)*s+(65280&e)*i&65280)+((255&t)*s+(255&e)*i&255);return a},t.newTextField=function(e,i,s,a,r,n,o){var h=new egret.TextField;return h.text=e,h.bold=n,h.size=i,h.textColor=s,o?(h.x=(t.width-h.width)*a,h.y=(t.height-h.height)*r):(h.x=t.width*a-.5*h.width,h.y=t.height*r-.5*h.height),h},t}();__reflect(Util.prototype,"Util");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.retryButton=null,e.step=0,e.fadeInFrame=64,e.texts[0]=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/12,FONT_COLOR,.5,.35,!0,!1),egret.Tween.get(e.texts[0],{loop:!1}).to({alpha:0},0).to({alpha:1},1e3),GameObject.baseDisplay.addChild(e.texts[0]),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.baseDisplay.removeChild(t)}),this.texts=null},e.prototype.update=function(){this.step++,this.step==this.fadeInFrame&&(this.retryButton=new Button("リトライ",Util.width/16,BACK_COLOR,.5,.75,.4,.1,FONT_COLOR,1,this.onTapRetry),Score.I.point>Score.I.bestScore&&(egret.localStorage.setItem(SAVE_KEY_BESTSCORE,Score.I.point.toFixed()),this.texts[1]=Util.newTextField("NEW RECORD!",Util.width/13,FONT_COLOR,.5,.45,!0,!1),egret.Tween.get(this.texts[1],{loop:!0}).to({alpha:0},500).to({alpha:1},500),GameObject.baseDisplay.addChild(this.texts[1])))},e.prototype.onTapRetry=function(){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Score=function(t){function e(){var i=t.call(this)||this;i.point=0,i.bestScore=0,i.text=null,i.textBest=null,e.I=i,i.point=0,i.text=Util.newTextField("0",Util.width/22,FONT_COLOR2,.5,0,!0,!0),GameObject.baseDisplay.addChild(i.text);var s=egret.localStorage.getItem(SAVE_KEY_BESTSCORE);return null==s&&(s="10",egret.localStorage.setItem(SAVE_KEY_BESTSCORE,s)),i.bestScore=parseInt(s),i.textBest=Util.newTextField("BEST:"+s,Util.width/22,FONT_COLOR2,0,0,!0,!0),GameObject.baseDisplay.addChild(i.textBest),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.baseDisplay.removeChild(this.text),this.text=null,GameObject.baseDisplay.removeChild(this.textBest),this.textBest=null,e.I=null},e.prototype.update=function(){},e.prototype.addPoint=function(t){void 0===t&&(t=1),this.point+=t,this.text.text=""+this.point.toFixed(),this.bestScore<this.point&&(this.textBest.text="BEST:"+this.point.toFixed())},e.I=null,e}(GameObject);__reflect(Score.prototype,"Score");var StartMessage=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.texts[0]=Util.newTextField("ドリ走",Util.width/12,FONT_COLOR,.5,.2,!0,!1),e.texts[1]=Util.newTextField("タッチ中は右へドリフト",Util.width/19,FONT_COLOR,.5,.3,!0,!1),e.texts[2]=Util.newTextField("華麗にドリフトを決めろ！",Util.width/19,FONT_COLOR,.5,.35,!0,!1),e.texts.forEach(function(t){GameObject.baseDisplay.addChild(t)}),GameObject.baseDisplay.once(egret.TouchEvent.TOUCH_TAP,e.tap,e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){t.parent.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.tap=function(t){Player.I.setStateRun(),this.destroy()},e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");